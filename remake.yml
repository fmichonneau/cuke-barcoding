packages:
  - ape
  - ridigbio
  - phylobase
  - ggplot2
  - igraph
  - methods
  - httr
  - chopper
  - maps
  - mapproj
  - sp
  - rgeos
  - xtable
  - car
  - parallel
  - wesanderson
  - tikzDevice
  - reshape2
  - seqinr
  - phytools
  - dplyr
  - storr


sources:
  - R/


targets:

  all:
    depends:
      - trees
      - validate_data
      #- clusters

  validate_data:
    depends:
      - validate_idigbio_specimens
      - validate_idigbio_coordinates
      - validate_nmv_specimens
      - validate_nmv_coordinates

  trees:
    depends:
      - data/trees/cuke_tree_raw.tre
      - data/trees/cuke_tree_k2p.tre

  ## raw data ------------------------------------------------------------------
  echino_db:
    command: load_echino_db("data/raw/20160722.MARBoL_Echinos_current.csv")

  cuke_db:
    command: load_cuke_db(echino_db)

  ## taxonomy ------------------------------------------------------------------
  taxonomy:
    command: load_taxonomy(cuke_db)

  ## compare with idigibio -----------------------------------------------------
  idigbio_ids:
    command: build_idigbio_ids(cuke_db)

  cuke_idigbio:
    command: get_idigbio_info(idigbio_ids)

  validate_idigbio_specimens:
    command: compare_idigbio_specimens(idigbio_ids, cuke_idigbio)

  validate_idigbio_coordinates:
    command: compare_idigbio_coordinates(idigbio_ids, cuke_idigbio)

  cuke_nmv:
    command: get_nmv_info("data/nmv_data.rds")

  validate_nmv_specimens:
    command: compare_nmv_specimens(cuke_nmv)

  validate_nmv_coordinates:
    command: compare_nmv_coordinates(cuke_nmv, cuke_db)

  ## validate geographical information -----------------------------------------
  external_geodata:
    command: get_external_geodata(cuke_db)

  add_geodata:
    command: add_geodata_to_cuke_db(cuke_db, external_geodata)

  ## BOLD specimen data --------------------------------------------------------
  bold_data:
    command: generate_bold_data(add_geodata)

  ## sequences -----------------------------------------------------------------
  cuke_seqs:
    command: load_cuke_seqs(cuke_db)

  data/seq/cuke_alg_unaligned.fas:
    command: generate_unaligned_cuke_fasta(cuke_seqs)

  data/seq/cuke_alg_aligned.fas:
    command: generate_aligned_cuke_fasta("data/seq/cuke_alg_unaligned.fas")

  data/seq/cuke_alg_cleaned.fas:
    command: generate_cleaned_cuke_fasta("data/seq/cuke_alg_aligned.fas")

  cuke_alg:
    command: load_cuke_alg("data/seq/cuke_alg_cleaned.fas")

  ## distance matrices ---------------------------------------------------------
  cuke_dist_raw:
    command: load_cuke_dist_raw(cuke_alg)

  cuke_dist_k2p:
    command: load_cuke_dist_k2p(cuke_alg)

  ## trees ---------------------------------------------------------------------
  cuke_tree_raw:
    command: load_cuke_tree(cuke_alg, dist_mat = cuke_dist_raw, model=I("raw"), Nrep=I(1))

  cuke_tree_k2p:
    command: load_cuke_tree(cuke_alg, dist_mat = cuke_dist_k2p, model=I("K80"), Nrep=I(1))

  data/trees/cuke_tree_raw.tre:
    command: write_tree(cuke_tree_raw, file = I("data/trees/cuke_tree_raw.tre"))

  data/trees/cuke_tree_k2p.tre:
    command: write_tree(cuke_tree_k2p, file = I("data/trees/cuke_tree_k2p.tre"))

  cuke_tree_raw_phylo4:
    command: load_cuke_tree_raw_phylo4(cuke_tree_raw)

  cuke_tree_k2p_phylo4:
    command: load_cuke_tree_k2p_phylo4(cuke_tree_k2p)

  #cuke_tree_raxml:
  #  command: load_tree_raxml("data/raxml/RAxML_bipartitionsBranchLabels.cukeBarcodes",
  #                           cuke_db)

  #cuke_tree_raxml_phylo4:
  #  command: load_tree_raxml_phylo4(cuke_tree_raxml)

  ## ESU delineation   ---------------------------------------------------------
  clusters:
    command: make_cuke_tree_clusters(taxonomy, cuke_db, methods=I(c("raw", "k2p")), cuke_tree_raw_phylo4, cuke_tree_k2p_phylo4)


  ## species-overlap -----------------------------------------------------------
  species_overlap:
    command: build_species_overlap()
