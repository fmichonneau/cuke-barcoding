packages:
  - ape
  - ridigbio
  - phylobase
  - ggplot2
  - igraph
  - methods
  - doMC
  - chopper
  - maps
  - sp
  - rgeos
  - xtable
  - car
  - wesanderson
  - tikzDevice
  - reshape2
  - seqinr
  - phytools


sources:
  - R/


targets:

  all:
    depends:
      - trees
      - cuke_idigbio
      - validate_idigbio
      #- compare_identifications
      #- taxonomy
      #- cluster_groups_raw
      #- cuke_tree_raxml_phylo4

  trees:
    depends:
      - cuke_tree_raw
      - cuke_tree_k2p
      - cuke_tree_raw_phylo4
      - cuke_tree_k2p_phylo4

  ## raw data ------------------------------------------------------------------
  echino_db:
    command: load_echino_db("data/raw/20160628.MARBoL_Echinos_current.csv")

  cuke_db:
    command: load_cuke_db(echino_db)

  ## compare with idigibio -----------------------------------------------------
  idigbio_ids:
    command: build_idigbio_ids(cuke_db)

  cuke_idigbio:
    command: get_idigbio(idigbio_ids)

  validate_idigbio:
    command: check_idigbio(idigbio_ids, cuke_idigbio)

  ## sequences -----------------------------------------------------------------
  cuke_seqs:
    command: load_cuke_seqs(cuke_db)

  data/seq/cuke_alg_unaligned.fas:
    command: generate_unaligned_cuke_fasta(cuke_seqs)

  data/seq/cuke_alg_aligned.fas:
    command: generate_aligned_cuke_fasta("data/seq/cuke_alg_unaligned.fas")

  data/seq/cuke_alg_cleaned.fas:
    command: generate_cleaned_cuke_fasta("data/seq/cuke_alg_aligned.fas")

  cuke_alg:
    command: load_cuke_alg("data/seq/cuke_alg_cleaned.fas")

  ## distance matrices ---------------------------------------------------------
  cuke_dist_raw:
    command: load_cuke_dist_raw(cuke_alg)

  cuke_dist_k2p:
    command: load_cuke_dist_k2p(cuke_alg)

  ## trees ---------------------------------------------------------------------
  cuke_tree_raw:
    command: load_cuke_tree(cuke_alg, dist_mat = cuke_dist_raw, model=I("raw"), Nrep=I(1))

  cuke_tree_k2p:
    command: load_cuke_tree(cuke_alg, dist_mat = cuke_dist_k2p, model=I("K80"), Nrep=I(1))

  cuke_tree_raw_phylo4:
    command: load_cuke_tree_raw_phylo4(cuke_tree_raw)

  cuke_tree_k2p_phylo4:
    command: load_cuke_tree_k2p_phylo4(cuke_tree_k2p)

  cuke_tree_raxml:
    command: load_tree_raxml("data/raxml/RAxML_bipartitionsBranchLabels.cukeBarcodes",
                             cuke_db)

  cuke_tree_raxml_phylo4:
    command: load_tree_raxml_phylo4(cuke_tree_raxml)


  ## ESU delineation   ---------------------------------------------------------
  cuke_tree_clusters:
    command: load_cuke_tree_clusters(taxonomy, cuke_db, methods=I(c("raw", "k2p")), cuke_tree_raw_phylo4, cuke_tree_k2p_phylo4)

  ## taxonomy ------------------------------------------------------------------
  taxonomy:
    command: load_taxonomy(cuke_db)


  # compare_identifications:
  #   command: compare_idig_cuke_db(cuke_db = cukeDB)



  # data/raxml/RAxML_bipartitionsBranchLabels.cukeBarcodes:
  #   command: build_raxml_tree("data/seq/cukeAlg-cleaned.fas")
